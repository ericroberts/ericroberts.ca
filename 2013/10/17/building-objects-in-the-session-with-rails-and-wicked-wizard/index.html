<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title>Building Objects in the Session with Rails and Wicked Wizard</title>
  <meta name="viewport" content="width=device-width">
  <link href='http://fonts.googleapis.com/css?family=Source+Sans+Pro:200,300,400,600,700,900,200italic,300italic,400italic,600italic,700italic,900italic' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Roboto+Slab:400,300,100' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic,700italic' rel='stylesheet' type='text/css'>
  <link rel="stylesheet" href="/assets/app-a847808fceed40565a1baba14ea3b020.css">
</head>
<body>
  <section role="main">
    <header class="post">
  <div class="row">
    <div class="columns large-12">
      <nav><a href="/">&laquo; Back to home</a></nav>
    </div>
  </div>
</header>
<div class="row">
  <div class="columns large-12">
    <article class="post">
      <header>
        <h4 class="meta">17 Oct 2013</h4>
        <h1>Building Objects in the Session with Rails and Wicked Wizard</h1>
      </header>

      <div class="post-content">
        <p>Recently I stumbled across a great gem, <a href="https://github.com/schneems/wicked">Wicked Wizard</a>. As I dug in further I noticed they had a great guide for <a href="https://github.com/schneems/wicked/wiki/Building-Partial-Objects-Step-by-Step">building partial objects step by step</a>. However, it didn&#39;t seem to do quite what I wanted. I was looking for something that:</p>

<ol>
<li><span>Doesn&#39;t require the model have knowledge of the wizard in order to perform validations.</span></li>
<li><span>Doesn&#39;t require me to clean up incomplete objects when someone didn&#39;t go through the whole wizard.</span></li>
</ol>

<p>I decided to start tackling requirement 2 first, since I had an idea how to go about that. I figured if I stored objects in the session, I could just keep building it there until it came time for the final submission. I googled for a solution and the closest thing I could find was <a href="https://gist.github.com/kizzx2/4722784">this gist</a> about using the session to store a partial object. When I tried to use it though, it didn&#39;t work for me. Based on the gist though, I was able to come up with a solution which I&#39;ll detail below. I&#39;ll use the same example as the Wicked Wizard guide (a product).</p>

<p>First, let&#39;s create our product class:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="k">class</span> <span class="nc">Product</span> <span class="o">&lt;</span> <span class="no">ActiveRecord</span><span class="o">::</span><span class="no">Base</span>
<span class="lineno">2</span>   <span class="n">attr_accessible</span> <span class="ss">:category</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:price</span>
<span class="lineno">3</span> 
<span class="lineno">4</span>   <span class="n">validates_presence_of</span> <span class="ss">:category</span><span class="p">,</span> <span class="ss">:name</span><span class="p">,</span> <span class="ss">:price</span>
<span class="lineno">5</span> <span class="k">end</span></code></pre></div>

<p>Next, let&#39;s begin creating our controller. Starting from what Wicked Wizard tells us to do, we&#39;d have something like this:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">ProductWizardController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="lineno"> 2</span>   <span class="kp">include</span> <span class="no">Wicked</span><span class="o">::</span><span class="no">Wizard</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span>   <span class="n">steps</span> <span class="ss">:add_name</span><span class="p">,</span> <span class="ss">:add_price</span><span class="p">,</span> <span class="ss">:add_category</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>   <span class="k">def</span> <span class="nf">show</span>
<span class="lineno"> 7</span>     <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:product_id</span><span class="o">]</span><span class="p">)</span>
<span class="lineno"> 8</span>     <span class="n">render_wizard</span>
<span class="lineno"> 9</span>   <span class="k">end</span>
<span class="lineno">10</span> 
<span class="lineno">11</span>   <span class="k">def</span> <span class="nf">update</span>
<span class="lineno">12</span>     <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:product_id</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">13</span>     <span class="vi">@product</span><span class="o">.</span><span class="n">update_attributes</span><span class="p">(</span><span class="n">params</span><span class="o">[</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">14</span>     <span class="n">render_wizard</span> <span class="vi">@product</span>
<span class="lineno">15</span>   <span class="k">end</span>
<span class="lineno">16</span> 
<span class="lineno">17</span>   <span class="k">def</span> <span class="nf">create</span>
<span class="lineno">18</span>     <span class="vi">@product</span> <span class="o">=</span> <span class="no">Product</span><span class="o">.</span><span class="n">create</span>
<span class="lineno">19</span>     <span class="n">redirect_to</span> <span class="n">wizard_path</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">first</span><span class="p">,</span> <span class="ss">:product_id</span> <span class="o">=&gt;</span> <span class="vi">@product</span><span class="o">.</span><span class="n">id</span><span class="p">)</span>
<span class="lineno">20</span>   <span class="k">end</span>
<span class="lineno">21</span> <span class="k">end</span></code></pre></div>

<p>But the <code>Product.find(params[:product_id])</code> and <code>Product.create</code> lines aren&#39;t going to work for us anymore. In fact, it doesn&#39;t make sense to have a create action at all, since we don&#39;t create a product to start. So let&#39;s remove the create action and put a new action in it&#39;s place:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="k">def</span> <span class="nf">new</span>
<span class="lineno">2</span>   <span class="n">product</span> <span class="o">=</span> <span class="no">WizardProduct</span><span class="o">.</span><span class="n">new</span>
<span class="lineno">3</span> 
<span class="lineno">4</span>   <span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">]</span> <span class="o">||=</span> <span class="p">{}</span>
<span class="lineno">5</span>   <span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">][</span><span class="ss">:product</span><span class="o">]</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">accessible_attributes</span>
<span class="lineno">6</span> 
<span class="lineno">7</span>   <span class="n">redirect_to</span> <span class="n">wizard_path</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
<span class="lineno">8</span> <span class="k">end</span></code></pre></div>

<p>You haven&#39;t seen the WizardProduct class yet, but we&#39;ll get to that in a minute. What we&#39;ve done is instantiated a new product, stored any data that product has in the session, and then redirected to step one of our wizard, <code>:add_name</code>. As I mentioned earlier, we can&#39;t use <code>Product.find</code> anymore, so let&#39;s change our show action to the following:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno">1</span> <span class="k">def</span> <span class="nf">show</span>
<span class="lineno">2</span>   <span class="vi">@product</span> <span class="o">=</span> <span class="no">WizardProduct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">][</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">3</span>   <span class="vi">@step</span> <span class="o">=</span> <span class="n">step</span>
<span class="lineno">4</span> 
<span class="lineno">5</span>   <span class="n">render_wizard</span>
<span class="lineno">6</span> <span class="k">end</span></code></pre></div>

<p>Instead of going and finding our object like we would with a database, we&#39;re going to instantiate a new one each time with the attributes we&#39;ve stored in the session. Initially I tried storing the whole object in the session but due to limitations on how much you can store there this would consistently fail.</p>

<p>Next, we&#39;ll also need to remove <code>Product.find</code> in the update action:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="k">def</span> <span class="nf">update</span>
<span class="lineno"> 2</span>   <span class="vi">@product</span> <span class="o">=</span> <span class="no">WizardProduct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">][</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>
<span class="lineno"> 3</span>   <span class="vi">@product</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:product</span><span class="o">]</span>
<span class="lineno"> 4</span> 
<span class="lineno"> 5</span>   <span class="vi">@product</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
<span class="lineno"> 6</span>   <span class="vi">@product</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<span class="lineno"> 7</span>   <span class="vi">@product</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
<span class="lineno"> 8</span>   <span class="vi">@product</span><span class="o">.</span><span class="n">validations</span> <span class="o">=</span> <span class="n">validations</span>
<span class="lineno"> 9</span> 
<span class="lineno">10</span>   <span class="n">render_wizard</span> <span class="vi">@product</span>
<span class="lineno">11</span> <span class="k">end</span></code></pre></div>

<p>Now things are getting a bit more complicated and it&#39;s time to discuss the WizardProduct class. What we&#39;ve done so far is to instantiate our WizardProduct object with the attributes stored in the session, and we&#39;ve added a bunch of data to it that our WizardProduct class will need to do it&#39;s job. Let&#39;s take a look at WizardProduct:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">WizardProduct</span> <span class="o">&lt;</span> <span class="no">Product</span>
<span class="lineno"> 2</span>   <span class="kp">attr_accessor</span> <span class="ss">:step</span><span class="p">,</span> <span class="ss">:steps</span><span class="p">,</span> <span class="ss">:session</span><span class="p">,</span> <span class="ss">:validations</span>
<span class="lineno"> 3</span>   
<span class="lineno"> 4</span>   <span class="vc">@@parent</span> <span class="o">=</span> <span class="n">superclass</span>
<span class="lineno"> 5</span>   
<span class="lineno"> 6</span>   <span class="k">def</span> <span class="nf">underscored_name</span>
<span class="lineno"> 7</span>     <span class="vc">@@parent</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">underscore</span>
<span class="lineno"> 8</span>   <span class="k">end</span>
<span class="lineno"> 9</span>   
<span class="lineno">10</span>   <span class="k">def</span> <span class="nc">self</span><span class="o">.</span><span class="nf">model_name</span>
<span class="lineno">11</span>     <span class="vc">@@parent</span><span class="o">.</span><span class="n">model_name</span>
<span class="lineno">12</span>   <span class="k">end</span>
<span class="lineno">13</span>   
<span class="lineno">14</span>   <span class="k">def</span> <span class="nf">save</span>
<span class="lineno">15</span>     <span class="n">valid?</span>
<span class="lineno">16</span>     
<span class="lineno">17</span>     <span class="n">remove_errors_from_other_steps</span>
<span class="lineno">18</span>     
<span class="lineno">19</span>     <span class="k">if</span> <span class="n">errors</span><span class="o">.</span><span class="n">empty?</span>
<span class="lineno">20</span>       <span class="k">if</span> <span class="n">step</span> <span class="o">==</span> <span class="n">steps</span><span class="o">.</span><span class="n">last</span>
<span class="lineno">21</span>         <span class="n">obj</span> <span class="o">=</span> <span class="vc">@@parent</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">accessible_attributes</span><span class="p">)</span>
<span class="lineno">22</span>         
<span class="lineno">23</span>         <span class="n">session</span><span class="o">.</span><span class="n">delete</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">underscored_name</span><span class="si">}</span><span class="s2">_builder&quot;</span><span class="o">.</span><span class="n">to_sym</span><span class="p">)</span> <span class="k">if</span> <span class="n">obj</span><span class="o">.</span><span class="n">save</span>
<span class="lineno">24</span>       <span class="k">else</span>
<span class="lineno">25</span>         <span class="n">session</span><span class="o">[</span><span class="s2">&quot;</span><span class="si">#{</span><span class="n">underscored_name</span><span class="si">}</span><span class="s2">_builder&quot;</span><span class="o">.</span><span class="n">to_sym</span><span class="o">][</span><span class="n">underscored_name</span><span class="o">.</span><span class="n">to_sym</span><span class="o">]</span> <span class="o">=</span> <span class="n">accessible_attributes</span>
<span class="lineno">26</span>       <span class="k">end</span>
<span class="lineno">27</span>     <span class="k">end</span>
<span class="lineno">28</span>   <span class="k">end</span>
<span class="lineno">29</span>   
<span class="lineno">30</span>   <span class="k">def</span> <span class="nf">accessible_attributes</span>
<span class="lineno">31</span>     <span class="n">aa</span> <span class="o">=</span> <span class="vc">@@parent</span><span class="o">.</span><span class="n">accessible_attributes</span>
<span class="lineno">32</span>     <span class="n">attributes</span><span class="o">.</span><span class="n">reject!</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="o">!</span><span class="n">aa</span><span class="o">.</span><span class="n">member?</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">}</span>
<span class="lineno">33</span>   <span class="k">end</span>
<span class="lineno">34</span>   
<span class="lineno">35</span>   <span class="k">def</span> <span class="nf">remove_errors_from_other_steps</span>
<span class="lineno">36</span>     <span class="n">other_step_validation_keys</span> <span class="o">=</span> <span class="p">(</span><span class="n">errors</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">keys</span> <span class="o">-</span> <span class="n">validations</span><span class="o">[</span><span class="n">step</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">37</span>     <span class="n">errors</span><span class="o">.</span><span class="n">messages</span><span class="o">.</span><span class="n">reject!</span> <span class="p">{</span> <span class="o">|</span><span class="n">key</span><span class="o">|</span> <span class="n">other_step_validation_keys</span><span class="o">.</span><span class="n">include?</span><span class="p">(</span><span class="n">key</span><span class="p">)</span> <span class="p">}</span>
<span class="lineno">38</span>   <span class="k">end</span>
<span class="lineno">39</span> <span class="k">end</span></code></pre></div>

<p>OK. What does this do? Well we&#39;ve got some accessors for the step we&#39;re currently on, a list of all the steps, the session itself, and validations we need to perform. Then we store the parent class as a class variable, and get some helper methods related to the parent class that we&#39;ll need later.</p>

<p>A key part of this is rewriting the save method. Here, we check if the object is valid, and then remove all the errors we don&#39;t care about. Finally, we check if there are no errors. If not, but we&#39;re not at the last step yet, we store the attributes of the object in the session. The controller takes care of moving to the next step. If we&#39;re at the last step, we instantiate a new instance of the parent model with the attributes we retrieved from the session, and save it. And there you have it! </p>

<h3>Limitations</h3>

<p>There are a couple limitations with the way I&#39;m currently doing things.</p>

<ol>
<li><span>All attributes must be mass-assignable. This is how I can do <code>@@parent.new(accessible_attributes)</code>. There are ways around this, but it makes sense, since you are assigning these attributes through the interface. I&#39;m working on an updated version for Rails 4 that will use strong params instead.</span></li>
<li><span>Assocations don&#39;t work at all. If you accept nested attributes for things, this just flat out won&#39;t work. It is fairly easy to make it work on a case by case basis, but I haven&#39;t figured out a generalized solution yet. I&#39;m happy to hear suggestions!</span></li>
</ol>

<p>If you have ways you think these limitations could be overcome, or you think I could do certain things better, feel free to get in touch with <a href="http://twitter.com/eroberts">me on Twitter</a>.</p>

<h3>Help</h3>

<p>Please help! Accepting pull requests, praise, criticism, and thinly veiled hatred.</p>

<h3>Final notes</h3>

<p>You can find the project on GitHub at <a href="https://github.com/ericroberts/wizard-object">github.com/ericroberts/wizard-object</a></p>

<p>By the way, here&#39;s the full controller with all the changes we made:</p>

<div class="highlight"><pre><code class="language-ruby" data-lang="ruby"><span class="lineno"> 1</span> <span class="k">class</span> <span class="nc">ProductWizardController</span> <span class="o">&lt;</span> <span class="no">ApplicationController</span>
<span class="lineno"> 2</span>   <span class="kp">include</span> <span class="no">Wicked</span><span class="o">::</span><span class="no">Wizard</span>
<span class="lineno"> 3</span> 
<span class="lineno"> 4</span>   <span class="n">steps</span> <span class="ss">:add_name</span><span class="p">,</span> <span class="ss">:add_price</span><span class="p">,</span> <span class="ss">:add_category</span>
<span class="lineno"> 5</span> 
<span class="lineno"> 6</span>   <span class="k">def</span> <span class="nf">new</span>
<span class="lineno"> 7</span>     <span class="n">product</span> <span class="o">=</span> <span class="no">WizardProduct</span><span class="o">.</span><span class="n">new</span>
<span class="lineno"> 8</span> 
<span class="lineno"> 9</span>     <span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">]</span> <span class="o">||=</span> <span class="p">{}</span>
<span class="lineno">10</span>     <span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">][</span><span class="ss">:product</span><span class="o">]</span> <span class="o">=</span> <span class="n">product</span><span class="o">.</span><span class="n">accessible_attributes</span>
<span class="lineno">11</span> 
<span class="lineno">12</span>     <span class="n">redirect_to</span> <span class="n">wizard_path</span><span class="p">(</span><span class="n">steps</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
<span class="lineno">13</span>   <span class="k">end</span>
<span class="lineno">14</span> 
<span class="lineno">15</span>   <span class="k">def</span> <span class="nf">show</span>
<span class="lineno">16</span>     <span class="vi">@pick</span> <span class="o">=</span> <span class="no">WizardProduct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">][</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">17</span>     <span class="vi">@step</span> <span class="o">=</span> <span class="n">step</span>
<span class="lineno">18</span> 
<span class="lineno">19</span>     <span class="n">render_wizard</span>
<span class="lineno">20</span>   <span class="k">end</span>
<span class="lineno">21</span> 
<span class="lineno">22</span>   <span class="k">def</span> <span class="nf">update</span>
<span class="lineno">23</span>     <span class="vi">@product</span> <span class="o">=</span> <span class="no">WizardProduct</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="n">session</span><span class="o">[</span><span class="ss">:product_wizard</span><span class="o">][</span><span class="ss">:product</span><span class="o">]</span><span class="p">)</span>
<span class="lineno">24</span>     <span class="vi">@product</span><span class="o">.</span><span class="n">attributes</span> <span class="o">=</span> <span class="n">params</span><span class="o">[</span><span class="ss">:product</span><span class="o">]</span>
<span class="lineno">25</span> 
<span class="lineno">26</span>     <span class="vi">@product</span><span class="o">.</span><span class="n">step</span> <span class="o">=</span> <span class="n">step</span>
<span class="lineno">27</span>     <span class="vi">@product</span><span class="o">.</span><span class="n">steps</span> <span class="o">=</span> <span class="n">steps</span>
<span class="lineno">28</span>     <span class="vi">@product</span><span class="o">.</span><span class="n">session</span> <span class="o">=</span> <span class="n">session</span>
<span class="lineno">29</span>     <span class="vi">@product</span><span class="o">.</span><span class="n">validations</span> <span class="o">=</span> <span class="n">validations</span>
<span class="lineno">30</span> 
<span class="lineno">31</span>     <span class="n">render_wizard</span> <span class="vi">@product</span>
<span class="lineno">32</span>   <span class="k">end</span>
<span class="lineno">33</span> 
<span class="lineno">34</span>   <span class="k">def</span> <span class="nf">finish_wizard_path</span>
<span class="lineno">35</span>     <span class="n">products_path</span>
<span class="lineno">36</span>   <span class="k">end</span>
<span class="lineno">37</span> 
<span class="lineno">38</span>   <span class="k">def</span> <span class="nf">validations</span>
<span class="lineno">39</span>     <span class="p">{</span>
<span class="lineno">40</span>       <span class="ss">add_name</span><span class="p">:</span> <span class="o">[</span><span class="ss">:name</span><span class="o">]</span><span class="p">,</span>
<span class="lineno">41</span>       <span class="ss">add_price</span><span class="p">:</span> <span class="o">[</span><span class="ss">:price</span><span class="o">]</span><span class="p">,</span>
<span class="lineno">42</span>       <span class="ss">add_category</span><span class="p">:</span> <span class="o">[</span><span class="ss">:category</span><span class="o">]</span>
<span class="lineno">43</span>     <span class="p">}</span>
<span class="lineno">44</span>   <span class="k">end</span>
<span class="lineno">45</span> <span class="k">end</span></code></pre></div>

      </div>

      <footer>
      </footer>
      <div id="disqus_thread"></div>
      <script type="text/javascript">
        /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'ericroberts'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
      </script>
      <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
      <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </article>
  </div>
</div>

  </section>

  <footer>
    <div class="row">
    </div>
  </footer>
  <script type="text/javascript">

    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-16269631-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();

  </script>

  <script type="text/javascript">
    window.analytics=window.analytics||[],window.analytics.methods=["identify","group","track","page","pageview","alias","ready","on","once","off","trackLink","trackForm","trackClick","trackSubmit"],window.analytics.factory=function(t){return function(){var a=Array.prototype.slice.call(arguments);return a.unshift(t),window.analytics.push(a),window.analytics}};for(var i=0;i<window.analytics.methods.length;i++){var key=window.analytics.methods[i];window.analytics[key]=window.analytics.factory(key)}window.analytics.load=function(t){if(!document.getElementById("analytics-js")){var a=document.createElement("script");a.type="text/javascript",a.id="analytics-js",a.async=!0,a.src=("https:"===document.location.protocol?"https://":"http://")+"cdn.segment.io/analytics.js/v1/"+t+"/analytics.min.js";var n=document.getElementsByTagName("script")[0];n.parentNode.insertBefore(a,n)}},window.analytics.SNIPPET_VERSION="2.0.9",
    window.analytics.load("ixl7f3o7kf");
    window.analytics.page();
  </script>
</body>
</html>
